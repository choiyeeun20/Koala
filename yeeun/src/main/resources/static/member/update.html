<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
 <style>

.form-signin .form-control {
    position: relative;
    box-sizing: border-box;
    height: auto;
    padding: 10px;
    font-size: 16px;
}
.form-signin {
    width: 100%;
    max-width: 330px;
    padding: 15px;
    margin: 0 auto;
}
 
 </style>
  </head>
<title>Insert title here</title>
</head>
<body class="bg-light">

    <div class="container">
      <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="https://image.flaticon.com/icons/svg/2833/2833800.svg" alt="" width="72" height="72">
        <h2>Update</h2>
      </div>

      <div class="row">
        
        <div class="col-md-8 order-md-1">
          <form class="needs-validation" novalidate="">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="name">Name</label>
              <div class="input-group mb-3">
				  <input id="name" type="text" class="form-control"  aria-describedby="basic-addon1">
				</div>  
              </div>
            </div>

            <div class="mb-3">
              <label for="userid">Userid</label>
                <nav aria-label="breadcrumb">
				   <ol class="breadcrumb"><li id ="userid" class="breadcrumb-item active" aria-current="page"></li></ol>
			    </nav>
            </div>
            <div class="mb-3">
              <label for="addr">Address</label>
              <div class="input-group mb-3">
				  <input id="addr" type="text" class="form-control"  aria-describedby="basic-addon1">
				</div>
            </div>
            <div class="mb-3">
              <label for="ssn">Ssn</label>
              <nav aria-label="breadcrumb">
				  <ol class="breadcrumb"><li id ="ssn" class="breadcrumb-item active" aria-current="page"></li></ol>
			    </nav>
            </div>
           <div class="mb-3">
              <label for="passwd">Password</label>
             <div class="input-group mb-3">
				  <input id="passwd" type="text" class="form-control" aria-describedby="basic-addon1">
				</div>
			    </div>
      <button class="btn btn-lg btn-primary btn-block" id = "update-button" type="button">Update account</button>
      <button class="btn btn-lg btn-primary btn-block" id = "remove-button" type="button">Delete account</button>
      <button class="btn btn-lg btn-primary btn-block" id = "cancel-button" type="button">Cancel</button></botton>
    </form>
    </div>
    </div>
</body>
<script>
(function() {
    'use strict';

    window.addEventListener('load', function() {
      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.getElementsByClassName('needs-validation');

      // Loop over them and prevent submission
      var validation = Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();
$.getJSON('/member/detail/'+sessionStorage.getItem('userid'),d =>{
	  $('#name').val(d.name)
	  $('#userid').text(d.userid)
	  $('#addr').val(d.addr)
	  $('#ssn').text(d.ssn)
	  $('#passwd').val(d.passwd)
	  const name = $('#name').val()
	  const addr = $('#addr').val()
	  const passwd = $('#passwd').val()
	  alert('수정전 정보:' + name +','+ addr+','+ passwd)
	  $('#cancel_button').click(e=>{
  	  e.preventDefault()
  	  location.href = "mypage.html"
    })

$('#update-button').click(e=>{
	  e.preventDefault()
	  alert(' 수정 하려는 정보 >>>>>>>> '+$('#name').val()  +','+$('#addr').val() +','+$('#passwd').val())
	  if(name === $('#name').val() 
			  && addr === $('#addr').val() 
			  && passwd === $('#passwd').val()){
		  alert('변경사항이 없습니다')
	  }else{
		  $.ajax({
			url : '/member/update',
		    type: 'put',
		    data: JSON.stringify({
			name : $('#name').val(), 
	    	userid :$('#userid').text(),
	    	addr:$('#addr').val(),
	    	ssn: $('#ssn').text(),
	    	passwd: $('#passwd').val()
		  }),	
		  dataType: 'json',
		  contentType : 'application/json',
		  success: d =>{
			if(d === 'SUCCESS'){
				location.href = "mypage.html"
			
			}else{
				location.href = "update.html"
			}
		},
		  error : (r, x, e)=>{
			  alert(r.status)
		  }
		  })
	  }
		 }) //
	 $('#remove_button').click(e=>{
		  e.preventDefault()
		  $.ajax({
			url:'/member/remove/'+sessionStorage.getItem('userid'),
			type:'delete',
			dataType:'json',
			contentType:'application/json',
			success: d=>{
				if(d ==='SUCCESS'){
				alert('탈퇴완료')
				sessionStorage.setItem('userid','')
				location.href= "../index2.html"
			}
		 }
	 })
})
})
</script>
</body>
</html>v